Generating unittest SQL file from sql/full.sql
sed '1s/^/USE unittest;\n/' sql/full.sql > sql/unittest/001_testtables.sql
docker compose run --rm -e APP_ENV=test app-dev php -d memory_limit=512M ./bin/phpunit
 Container timetracker-db-test-1  Running
 Container timetracker-db-1  Running
PHPUnit 12.3.6 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.4.12
Configuration: /var/www/html/phpunit.xml

...............................................................  63 / 312 ( 20%)
............................................................... 126 / 312 ( 40%)
..........D.D.......FFF........................................ 189 / 312 ( 60%)
.........FF............FF...DD..............SSSSSSSSSEEEE..FF.. 252 / 312 ( 80%)
..FF.........................F......FFFFFFSFS..FF..........F    312 / 312 (100%)

Time: 00:13.321, Memory: 84.50 MB

There were 4 errors:

1) Tests\Controller\ControllingControllerTest::testExportActionHidesBillableFieldWhenNotConfigured
LogicException: Cannot retrieve the container from a non-booted kernel.

/var/www/html/vendor/symfony/http-kernel/Kernel.php:272
/var/www/html/vendor/symfony/framework-bundle/Test/TestContainer.php:119
/var/www/html/vendor/symfony/framework-bundle/Test/TestContainer.php:124
/var/www/html/vendor/symfony/framework-bundle/Test/TestContainer.php:94
/var/www/html/tests/AbstractWebTestCase.php:333
/var/www/html/tests/Controller/ControllingControllerTest.php:229

2) Tests\Controller\ControllingControllerTest::testExportActionInvalidMonth
DateMalformedStringException: Failed to parse time string (2020-666-01) at position 6 (6): Unexpected character

/var/www/html/src/Repository/EntryRepository.php:720
/var/www/html/src/Service/ExportService.php:166
/var/www/html/src/Controller/Controlling/ExportAction.php:51
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:183
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:76
/var/www/html/vendor/symfony/http-kernel/Kernel.php:182
/var/www/html/vendor/symfony/http-kernel/HttpKernelBrowser.php:62
/var/www/html/vendor/symfony/framework-bundle/KernelBrowser.php:157
/var/www/html/vendor/symfony/browser-kit/AbstractBrowser.php:378
/var/www/html/tests/Controller/ControllingControllerTest.php:37

3) Tests\Controller\ControllingControllerTest::testExportActionInvalidYear
Doctrine\ORM\Query\QueryException: [Semantical Error] line 0, col 311 near 'username ASC,': Error: Class App\Entity\Entry has no field or association named user.username

/var/www/html/vendor/doctrine/orm/src/Query/QueryException.php:28
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:465
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:736
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:249
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:330
/var/www/html/vendor/doctrine/orm/src/Query.php:248
/var/www/html/vendor/doctrine/orm/src/Query.php:717
/var/www/html/vendor/doctrine/orm/src/Query.php:257
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:935
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:891
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:689
/var/www/html/src/Repository/EntryRepository.php:754
/var/www/html/src/Service/ExportService.php:166
/var/www/html/src/Controller/Controlling/ExportAction.php:51
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:183
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:76
/var/www/html/vendor/symfony/http-kernel/Kernel.php:182
/var/www/html/vendor/symfony/http-kernel/HttpKernelBrowser.php:62
/var/www/html/vendor/symfony/framework-bundle/KernelBrowser.php:157
/var/www/html/vendor/symfony/browser-kit/AbstractBrowser.php:378
/var/www/html/tests/Controller/ControllingControllerTest.php:49

Caused by
Doctrine\ORM\Query\QueryException: SELECT e FROM App\Entity\Entry e LEFT JOIN e.user u LEFT JOIN e.customer c LEFT JOIN e.project p LEFT JOIN e.activity a WHERE e.day >= :startOfYear AND e.day <= :endOfYear AND e.user = :user AND e.day >= :startOfMonth AND e.day <= :endOfMonth AND e.project = :project AND e.customer = :customer ORDER BY e.user.username ASC, e.entry.day ASC, e.entry.start ASC

/var/www/html/vendor/doctrine/orm/src/Query/QueryException.php:18
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:465
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:736
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:249
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:330
/var/www/html/vendor/doctrine/orm/src/Query.php:248
/var/www/html/vendor/doctrine/orm/src/Query.php:717
/var/www/html/vendor/doctrine/orm/src/Query.php:257
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:935
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:891
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:689
/var/www/html/src/Repository/EntryRepository.php:754
/var/www/html/src/Service/ExportService.php:166
/var/www/html/src/Controller/Controlling/ExportAction.php:51
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:183
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:76
/var/www/html/vendor/symfony/http-kernel/Kernel.php:182
/var/www/html/vendor/symfony/http-kernel/HttpKernelBrowser.php:62
/var/www/html/vendor/symfony/framework-bundle/KernelBrowser.php:157
/var/www/html/vendor/symfony/browser-kit/AbstractBrowser.php:378
/var/www/html/tests/Controller/ControllingControllerTest.php:49

4) Tests\Controller\ControllingControllerTest::testExportActionBasicResponse
Doctrine\ORM\Query\QueryException: [Semantical Error] line 0, col 311 near 'username ASC,': Error: Class App\Entity\Entry has no field or association named user.username

/var/www/html/vendor/doctrine/orm/src/Query/QueryException.php:28
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:465
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:736
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:249
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:330
/var/www/html/vendor/doctrine/orm/src/Query.php:248
/var/www/html/vendor/doctrine/orm/src/Query.php:717
/var/www/html/vendor/doctrine/orm/src/Query.php:257
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:935
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:891
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:689
/var/www/html/src/Repository/EntryRepository.php:754
/var/www/html/src/Service/ExportService.php:166
/var/www/html/src/Controller/Controlling/ExportAction.php:51
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:183
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:76
/var/www/html/vendor/symfony/http-kernel/Kernel.php:182
/var/www/html/vendor/symfony/http-kernel/HttpKernelBrowser.php:62
/var/www/html/vendor/symfony/framework-bundle/KernelBrowser.php:157
/var/www/html/vendor/symfony/browser-kit/AbstractBrowser.php:378
/var/www/html/tests/Controller/ControllingControllerTest.php:21

Caused by
Doctrine\ORM\Query\QueryException: SELECT e FROM App\Entity\Entry e LEFT JOIN e.user u LEFT JOIN e.customer c LEFT JOIN e.project p LEFT JOIN e.activity a WHERE e.day >= :startOfYear AND e.day <= :endOfYear AND e.user = :user AND e.day >= :startOfMonth AND e.day <= :endOfMonth AND e.project = :project AND e.customer = :customer ORDER BY e.user.username ASC, e.entry.day ASC, e.entry.start ASC

/var/www/html/vendor/doctrine/orm/src/Query/QueryException.php:18
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:465
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:736
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:249
/var/www/html/vendor/doctrine/orm/src/Query/Parser.php:330
/var/www/html/vendor/doctrine/orm/src/Query.php:248
/var/www/html/vendor/doctrine/orm/src/Query.php:717
/var/www/html/vendor/doctrine/orm/src/Query.php:257
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:935
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:891
/var/www/html/vendor/doctrine/orm/src/AbstractQuery.php:689
/var/www/html/src/Repository/EntryRepository.php:754
/var/www/html/src/Service/ExportService.php:166
/var/www/html/src/Controller/Controlling/ExportAction.php:51
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:183
/var/www/html/vendor/symfony/http-kernel/HttpKernel.php:76
/var/www/html/vendor/symfony/http-kernel/Kernel.php:182
/var/www/html/vendor/symfony/http-kernel/HttpKernelBrowser.php:62
/var/www/html/vendor/symfony/framework-bundle/KernelBrowser.php:157
/var/www/html/vendor/symfony/browser-kit/AbstractBrowser.php:378
/var/www/html/tests/Controller/ControllingControllerTest.php:21

--

There were 22 failures:

1) Tests\Repository\EntryRepositoryTest::testGetCalendarDaysByWorkDaysAcrossWeekend
Failed asserting that 1 is identical to 3.

/var/www/html/tests/Repository/EntryRepositoryTest.php:42

2) Tests\Repository\EntryRepositoryTest::testGetCalendarDaysByWorkDaysBasics
Failed asserting that 5 is identical to 7.

/var/www/html/tests/Repository/EntryRepositoryTest.php:70

3) Tests\Repository\EntryRepositoryTest::testGetCalendarDaysByWorkDaysMondayEdge
Failed asserting that 1 is identical to 3.

/var/www/html/tests/Repository/EntryRepositoryTest.php:91

4) Tests\Controller\AdminControllerTest::testGetTeamsAction
Subset element not found in array

/var/www/html/tests/AbstractWebTestCase.php:117
/var/www/html/tests/AbstractWebTestCase.php:549
/var/www/html/tests/Controller/AdminControllerTest.php:341

5) Tests\Controller\AdminControllerTest::testGetTeamsActionWithNonPL
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-'You are not allowed to perform this action.'
+'[{"team":{"id":2,"name":"Hackerman","lead_user_id":2}},{"team":{"id":1,"name":"Kuchenb\u00e4cker","lead_user_id":1}}]'

/var/www/html/tests/AbstractWebTestCase.php:526
/var/www/html/tests/Controller/AdminControllerTest.php:348

6) Tests\Controller\AdminControllerTest::testGetProjectsAction
Subset element not found in array

/var/www/html/tests/AbstractWebTestCase.php:117
/var/www/html/tests/AbstractWebTestCase.php:549
/var/www/html/tests/Controller/AdminControllerTest.php:240

7) Tests\Controller\AdminControllerTest::testGetProjectsActionWithNonPL
Failed asserting that two strings are identical.
--- Expected
+++ Actual
@@ @@
-'You are not allowed to perform this action.'
+'[{"project":{"id":3,"name":"GlobalProject","active":false,"customer":3,"global":false,"jiraId":"TIM-1","jira_id":"TIM-1","jiraTicket":null,"jira_ticket":null,"subtickets":"","ticketSystem":null,"ticket_system":null,"entries":{},"presets":{},"estimation":0,"offer":"0","billing":0,"costCenter":null,"cost_center":null,"internalReference":null,"internal_reference":null,"externalReference":null,"external_reference":null,"projectLead":null,"project_lead":null,"technicalLead":null,"technical_lead":null,"invoice":null,"additionalInformationFromExternal":false,"additional_information_from_external":false,"internalJiraProjectKey":"","internal_jira_project_key":"","internalJiraTicketSystem":"0","internal_jira_ticket_system":"0","estimationText":"0m"}}]'

/var/www/html/tests/AbstractWebTestCase.php:526
/var/www/html/tests/Controller/AdminControllerTest.php:247

8) Tests\CrudControllerNegativeTest::testSaveActionInvalidTicketFormat
Failed asserting that 200 is identical to 400.

/var/www/html/tests/AbstractWebTestCase.php:459
/var/www/html/tests/Controller/CrudControllerNegativeTest.php:36

9) Tests\CrudControllerNegativeTest::testSaveActionInvalidTicketPrefix
Failed asserting that 200 is identical to 400.

/var/www/html/tests/AbstractWebTestCase.php:459
/var/www/html/tests/Controller/CrudControllerNegativeTest.php:62

10) Tests\Controller\CrudControllerTest::testBulkentryActionSkipWeekend
Failed asserting that 3 is identical to 2.

/var/www/html/tests/Controller/CrudControllerTest.php:276

11) Tests\Controller\CrudControllerTest::testBulkentryActionContractEndedDuringBulkentry
Value mismatch at key 'end'
Failed asserting that false is true.

/var/www/html/tests/AbstractWebTestCase.php:68
/var/www/html/tests/AbstractWebTestCase.php:126
/var/www/html/tests/Controller/CrudControllerTest.php:446

12) Tests\Controller\DefaultControllerTest::testGetAllProjectsAction
Subset element not found in array

/var/www/html/tests/AbstractWebTestCase.php:117
/var/www/html/tests/AbstractWebTestCase.php:549
/var/www/html/tests/Controller/DefaultControllerTest.php:126

13) Tests\Controller\InterpretationControllerTest::testGetLastEntriesAction
Subset element not found in array

/var/www/html/tests/AbstractWebTestCase.php:117
/var/www/html/tests/AbstractWebTestCase.php:549
/var/www/html/tests/Controller/InterpretationControllerTest.php:63

14) Tests\Controller\InterpretationControllerTest::testGetAllEntriesActionWrongParameterDateAsInteger
Failed asserting that 200 is identical to 422.

/var/www/html/tests/AbstractWebTestCase.php:459
/var/www/html/tests/Controller/InterpretationControllerTest.php:138

15) Tests\Controller\InterpretationControllerTest::testGetAllEntriesActionReturnLinksNoParameter
Failed asserting that 8 is identical to 7.

/var/www/html/tests/AbstractWebTestCase.php:567
/var/www/html/tests/Controller/InterpretationControllerTest.php:355

16) Tests\Controller\InterpretationControllerTest::testGetAllEntriesActionReturnLinksLastPage
Value mismatch at key 'id'
Failed asserting that false is true.

/var/www/html/tests/AbstractWebTestCase.php:68
/var/www/html/tests/AbstractWebTestCase.php:77
/var/www/html/tests/AbstractWebTestCase.php:66
/var/www/html/tests/AbstractWebTestCase.php:126
/var/www/html/tests/AbstractWebTestCase.php:549
/var/www/html/tests/Controller/InterpretationControllerTest.php:423

17) Tests\Controller\InterpretationControllerTest::testGetAllEntriesActionReturnLinksPageOne
Value mismatch at key 'id'
Failed asserting that false is true.

/var/www/html/tests/AbstractWebTestCase.php:68
/var/www/html/tests/AbstractWebTestCase.php:77
/var/www/html/tests/AbstractWebTestCase.php:66
/var/www/html/tests/AbstractWebTestCase.php:126
/var/www/html/tests/AbstractWebTestCase.php:549
/var/www/html/tests/Controller/InterpretationControllerTest.php:378

18) Tests\Controller\InterpretationControllerTest::testGetAllEntriesActionReturnLinksPageTwo
Value mismatch at key 'id'
Failed asserting that false is true.

/var/www/html/tests/AbstractWebTestCase.php:68
/var/www/html/tests/AbstractWebTestCase.php:77
/var/www/html/tests/AbstractWebTestCase.php:66
/var/www/html/tests/AbstractWebTestCase.php:126
/var/www/html/tests/AbstractWebTestCase.php:549
/var/www/html/tests/Controller/InterpretationControllerTest.php:401

19) Tests\Controller\InterpretationControllerTest::testGetAllEntriesActionWrongParameterDateAsString
Failed asserting that 200 is identical to 422.

/var/www/html/tests/AbstractWebTestCase.php:459
/var/www/html/tests/Controller/InterpretationControllerTest.php:126

20) Tests\Controller\SecurityControllerTest::testAccessToProtectedRouteRedirectsToLogin
Failed asserting that 403 is identical to 302.

/var/www/html/tests/AbstractWebTestCase.php:459
/var/www/html/tests/Controller/SecurityControllerTest.php:32

21) Tests\Controller\SecurityControllerTest::testLogoutReturnsToLogin
Failed asserting that 403 is identical to 302.

/var/www/html/tests/AbstractWebTestCase.php:459
/var/www/html/tests/Controller/SecurityControllerTest.php:96

22) Tests\Controller\BasicAccessTest::testLoginThenAccessEndpoint
Failed asserting that 403 is identical to 302.

/var/www/html/tests/AbstractWebTestCase.php:459
/var/www/html/tests/Controller/BasicAccessTest.php:36

ERRORS!
Tests: 312, Assertions: 1836, Errors: 4, Failures: 22, Deprecations: 8, Skipped: 11.

make: *** [Makefile:73: test] Error 2
